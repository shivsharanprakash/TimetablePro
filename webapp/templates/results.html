{% extends "base.html" %}

{% block title %}Timetables - Timetable Pro{% endblock %}

{% block content %}
<div class="pt-24 pb-12 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-6 flex justify-between items-center">
      <div>
        <h2 class="text-3xl font-bold text-gray-900">Class Timetables</h2>
        {% if project_name %}
          <p class="text-gray-600 mt-1">Project: <span class="font-semibold">{{ project_name }}</span></p>
        {% endif %}
      </div>
      <div class="flex space-x-3">
        <a href="{{ url_for('dashboard') }}" class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition-colors">
          <i class="fas fa-arrow-left mr-2"></i>
          Dashboard
        </a>
        {% if project_id %}
          <a href="{{ url_for('download_all', project_id=project_id) }}" class="btn-primary inline-flex items-center px-6 py-2 text-white rounded-lg font-medium shadow-lg">
            <i class="fas fa-download mr-2"></i>
            Download All
          </a>
        {% endif %}
      </div>
    </div>

    {% for year, bundle in results.items() %}
      <div class="bg-white border border-gray-200 rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center">
            <i class="fas fa-calendar-week mr-2 text-blue-600"></i>
            {{ year }} â€” {{ bundle.semester }}
          </h3>
        </div>
        
        {% if bundle.warnings and bundle.warnings|length > 0 %}
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
            <div class="flex items-start">
              <i class="fas fa-exclamation-triangle text-yellow-600 mr-2 mt-1"></i>
              <div>
                <h4 class="font-semibold text-yellow-800 mb-2">Warnings:</h4>
                <ul class="list-disc list-inside text-yellow-700 space-y-1">
                  {% for w in bundle.warnings %}
                    <li>{{ w }}</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endif %}
        
        <div class="overflow-x-auto">
          <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-3 border border-gray-200 text-left font-semibold text-gray-700">Time</th>
                {% for d in bundle.day_headers %}
                  <th class="px-4 py-3 border border-gray-200 text-center font-semibold text-gray-700">{{ d }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for r in bundle.day_rows %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 border border-gray-200 font-medium text-gray-700">{{ r.label }}</td>
                {% for cell in r.cells %}
                  {% if cell == 'BREAK' %}
                    <td class="px-4 py-3 border border-gray-200 bg-yellow-50 text-amber-700 font-medium text-center">BREAK</td>
                  {% elif cell == 'SKIP' %}
                    {# covered by rowspan above #}
                  {% elif cell == 'FREE' %}
                    <td class="px-4 py-3 border border-gray-200 text-gray-400 text-center">FREE</td>
                  {% else %}
                    <td class="px-4 py-3 border border-gray-200 align-top" {% if cell.rowspan and cell.rowspan > 1 %}rowspan="{{ cell.rowspan }}"{% endif %}>
                      <div class="leading-tight">
                        <div class="font-medium text-gray-900">{{ cell.text }}</div>
                        {% if cell.room %}
                          <div class="text-xs text-gray-500 mt-1">
                            <i class="fas fa-map-marker-alt mr-1"></i>{{ cell.room }}
                          </div>
                        {% endif %}
                      </div>
                    </td>
                  {% endif %}
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endfor %}
    
    {% if project_id %}
      <div class="flex justify-center mt-6">
        <a href="{{ url_for('configure', project_id=project_id) }}" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
          <i class="fas fa-edit mr-2"></i>
          Edit Configuration
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
